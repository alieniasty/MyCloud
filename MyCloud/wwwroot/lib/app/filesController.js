!function(){"use strict";function e(e,t,n,a){t.params=n;var o=this;o.codes=[],o.folders=[],o.selectedIndexes=[],o.isGettingPreviews=!0,t.selected={value:0},e({url:"/api/files/getJsonFiles",method:"GET",params:{folder:t.params.folder}}).then(function(e){e.data?angular.forEach(e.data,function(e,t){o.codes.push(e),o.isGettingPreviews=!1}):o.isGettingPreviews=!1}),t.nextPicture=function(e){e>=0&&e<o.codes.length?$("#js-img-modal")[0].src="data:image/png;base64,".concat(o.codes[e]):t.selected={value:0}},t.deleteFile=function(n){e({url:"/api/files/deleteFile",method:"POST",data:{base64Code:o.codes[n],folder:t.params.folder}}).then(function(){$("#js-modal").css("display","none"),a.go(a.current,{},{reload:!0})})},t.deleteSelectedFiles=function(n){o.isGettingPreviews=!0,angular.forEach(n,function(n){e({url:"/api/files/deleteFile",method:"POST",data:{base64Code:o.codes[n],folder:t.params.folder}})}),o.isGettingPreviews=!1,a.go(a.current,{},{reload:!0})},t.moveSelectedFiles=function(n,i){o.isGettingPreviews=!0;var r=[];angular.forEach(n,function(e){r.push(o.codes[e])}),e({url:"/api/files/moveSelectedFiles",method:"POST",data:{codes:r,currentFolder:t.params.folder,newFolder:i}}),o.isGettingPreviews=!1,a.go(a.current,{},{reload:!0})},t.fileSelected=function(e){o.selectedIndexes.includes(e)?o.selectedIndexes=o.selectedIndexes.filter(function(t){return t!==e}):o.selectedIndexes.push(e)},t.clearSelections=function(){o.selectedIndexes=[],$(".circle-base").removeClass("circle-base-animation-checked")},t.folderRemovalClick=function(){$.confirm({title:"Usunięcie folderu",content:'<form action="" class="formName"><div class="form-group"><label>Podaj nazwę folderu aby potwierdzić usunięcie</label><input type="text" placeholder="Nazwa folderu..." class="name form-control" required /></div></form>',buttons:{formSubmit:{text:"Zatwierdź",btnClass:"btn-danger",action:function(){var n=this.$content.find(".name").val();if(!n)return $.alert("Nie wprowadzono nazwy folderu"),!1;n===t.params.folder?$.confirm({title:"Czy na pewno chcesz usunąć folder:",content:"<strong>"+n+" ?</strong>",buttons:{"usuń":{btnClass:"btn-danger",action:function(){e({url:"/api/folders/deleteFolder",method:"POST",data:{name:t.params.folder}}).then(function(){a.go("folders",{},{reload:!0})})}},anuluj:function(){return!0}}}):$.alert("Wprowadzona nazwa nie zgadza się z nazwą aktualnie otwartego folderu.")}},cofnij:function(){return!0}}})},t.shareFile=function(n){e({url:"/api/share/shareFile",method:"POST",data:{base64Code:o.codes[n],folder:t.params.folder}}).then(function(e){$("#js-modal").css("display","block"),$.confirm({icon:"fa fa-link",title:"Udostępnianie",content:'<form class="formName"><div class="form-group"><label> Skopiuj ten link i wyślij osobie której chcesz udostępnić ten obraz </label><textarea class="share-link-textarea">'+e.data+"</textarea></div></form>",buttons:{OK:function(){return!0}}})})},t.shareFolder=function(){e({url:"/api/share/shareFolder",method:"POST",data:{name:t.params.folder}}).then(function(e){$.confirm({icon:"fa fa-link",title:"Udostępnianie",content:'<form class="formName"><div class="form-group"><label> Skopiuj ten link i wyślij osobie której chcesz udostępnić ten folder </label><textarea class="share-link-textarea">'+e.data+"</textarea></div></form>",buttons:{OK:function(){return!0}}})})},t.getUserFolders=function(){0===o.folders.length&&e({url:"/api/folders/getUserFolders",method:"GET"}).then(function(e){e.data?angular.forEach(e.data,function(e,t){o.folders.push(e),o.isGettingPreviews=!1}):o.isGettingPreviews=!1})}}e.$inject=["$http","$scope","$stateParams","$state"],angular.module("appPanel").controller("filesController",e).directive("ngDownloadPreview",["$window","$timeout",function(e,t){return{restrict:"A",template:"<canvas/>",link:function(e,n,a){var o=e.$eval(a.ngDownloadPreview),i=n.find("canvas"),r=new Image;r.src="data:image/png;base64,".concat(o.base64Code),r.onload=function(){i.attr({width:150,height:100}),i[0].getContext("2d").drawImage(this,0,0,150,100)},t(function(){i.on("click",function(){$("#js-modal").css("display","block"),$("#js-img-modal")[0].src=r.src})})}}}]).directive("selectPreview",["$timeout",function(e){return{restrict:"E",templateUrl:"/views/selectPreview.html",link:function(t,n,a){e(function(){$(n).on("click",function(){$(this).children().toggleClass("circle-base-animation-checked")})})}}}])}();